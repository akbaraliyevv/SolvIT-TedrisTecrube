<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolvIT - Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f9fafb; }
        
        .sidebar-container { 
            width: 16rem; 
            height: 100vh; 
            position: fixed; 
            top: 0; 
            left: 0; 
            z-index: 50; 
            background: #111827; 
            transition: all 0.3s ease;
        }
        
        .content-area { margin-left: 16rem; min-height: 100vh; transition: all 0.3s ease; }
        
        @media (max-width: 1024px) { 
            .sidebar-container { transform: translateX(-100%); }
            .sidebar-container.active { transform: translateX(0); }
            .content-area { margin-left: 0; }
        }

        .nav-link {
            display: flex;
            items-center: center;
            padding: 0.75rem 1rem;
            color: #d1d5db;
            border-radius: 0.75rem;
            transition: all 0.2s;
        }

        .nav-link:hover { background: #1f2937; color: white; }
        .nav-link.active { background: #4f46e5; color: white; font-weight: 600; }
    </style>
</head>
<body>

    <button id="mobile-menu-button" class="lg:hidden fixed top-4 left-4 z-[60] bg-indigo-600 text-white p-2 rounded-md shadow-lg">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>

    <div id="sidebar" class="sidebar-container shadow-2xl overflow-y-auto">
        <div class="flex items-center px-6 h-20 border-b border-gray-800">
            <span class="text-2xl font-black text-white tracking-tighter">SolvIT<span class="text-indigo-500"></span></span>
        </div>
        
        <div class="p-6">
            <div class="flex items-center space-x-3 mb-8 p-3 bg-gray-800/50 rounded-2xl">
                <div class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold">
                    {{ current_user.full_name[0] | upper }}
                </div>
                <div class="overflow-hidden">
                    <p class="text-white text-sm font-bold truncate">{{ current_user.full_name }}</p>
                    <p class="text-xs text-gray-400">{{ current_user.role }}</p>
                </div>
            </div>

            <nav class="space-y-1">
                <p class="px-3 text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">Menyu</p>
                
                <a href="{{ url_for('dashboard') }}" class="nav-link active">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-10v10a1 1 0 001 1h3M14 10l-4-4-4 4"></path></svg>
                    Dashboard
                </a>

                <a href="{{ url_for('explore_issues') }}" class="nav-link">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    Problemlər
                </a>
                
                <a href="/new_issue" class="nav-link">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                    Yeni Bildiriş
                </a>

                <p class="px-3 text-[10px] font-bold text-gray-500 uppercase tracking-widest mt-8 mb-2">Sistem</p>
                
                <a href="{{ url_for('logout') }}" class="nav-link text-red-400 hover:bg-red-900/20">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    Çıxış
                </a>
            </nav>
        </div>
    </div>

    <div class="content-area">
<header class="h-20 bg-white border-b border-gray-200 flex items-center justify-between px-8 sticky top-0 z-40">
    <div class="flex flex-col">
        <h1 class="text-xl font-bold text-gray-800">Xoş gəldiniz, {{ user.full_name.split(' ')[0] }}!</h1>
        <div class="flex items-center text-indigo-600 text-xs font-semibold mt-1">
            <svg class="w-3.5 h-3.5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            {{ current_date }}
        </div>
    </div>
    
</header>

        <main class="p-6 lg:p-10">
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-10">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden group">
                    <div class="absolute right-0 top-0 h-full w-1.5 bg-yellow-400"></div>
                    <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Ümumi Açıq</p>
                    <p class="text-3xl font-black text-gray-900 mt-2">{{ total_open }}</p>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden">
                    <div class="absolute right-0 top-0 h-full w-1.5 bg-red-500"></div>
                    <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Təcili</p>
                    <p class="text-3xl font-black text-gray-900 mt-2">{{ high_priority }}</p>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden">
                    <div class="absolute right-0 top-0 h-full w-1.5 bg-emerald-500"></div>
                    <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Bugün Həll Edilən</p>
                    <p class="text-3xl font-black text-gray-900 mt-2">{{ closed_today }}</p>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden">
                    <div class="absolute right-0 top-0 h-full w-1.5 bg-indigo-500"></div>
                    <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Tapşırıqlarım</p>
                    <p class="text-3xl font-black text-gray-900 mt-2">{{ assigned_to_me }}</p>
                </div>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                <div class="xl:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-800 mb-6 flex items-center">
                        <span class="w-2 h-6 bg-indigo-600 rounded-full mr-3"></span>
                        Həftəlik Statistika
                    </h3>
                    <div class="h-80">
                        <canvas id="issueFlowChart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b border-gray-50 flex justify-between items-center">
                        <h3 class="font-bold text-gray-800">Son Bildirişlər</h3>
                        <a href="{{ url_for('explore_issues') }}" class="text-xs text-indigo-600 font-semibold hover:underline">Hamısı</a>
                    </div>
                    <div class="divide-y divide-gray-100">
{% for issue in recent_issues %}
    {% if issue.is_public %}  {# SƏTRİ ƏLAVƏ EDİLDİ: Yalnız is_public True olanlar üçün #}
    <div class="p-4 hover:bg-gray-50 transition cursor-pointer" onclick="window.location.href='/issue/{{ issue.id }}'">
        <div class="flex justify-between items-start mb-1">
            <span class="text-xs font-bold text-indigo-500">#{{ issue.id }}</span>
            <span class="px-2 py-0.5 text-[10px] font-bold rounded-md 
                {% if issue.status == 'Open' %} bg-yellow-100 text-yellow-700
                {% elif issue.status == 'Closed' %} bg-emerald-100 text-emerald-700
                {% else %} bg-blue-100 text-blue-700 {% endif %}">
                {{ issue.status }}
            </span>
        </div>
        <h4 class="text-sm font-semibold text-gray-800 truncate mb-2">{{ issue.title }}</h4>
        <div class="flex items-center text-[11px] text-gray-400">
            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            {{ issue.author.full_name if issue.author else "Sistem" }}
        </div>
    </div>
    {% endif %} {# SƏTRİ ƏLAVƏ EDİLDİ #}
{% else %}
    <p class="p-10 text-center text-sm text-gray-400 italic">Hələ ki, məlumat yoxdur.</p>
{% endfor %}                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Mobil Menyu Toggle
        const btn = document.getElementById('mobile-menu-button');
        const sidebar = document.getElementById('sidebar');
        btn.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });

        // Chart.js
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('issueFlowChart').getContext('2d');
            const chartData = JSON.parse('{{ chart_data | tojson | safe }}');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.labels, 
                    datasets: [
                        {
                            label: 'Yeni',
                            data: chartData.new_issues, 
                            borderColor: '#4f46e5',
                            backgroundColor: 'rgba(79, 70, 229, 0.05)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3,
                            pointRadius: 4,
                            pointBackgroundColor: '#fff',
                            pointBorderColor: '#4f46e5'
                        },
                        {
                            label: 'Həll Edilən',
                            data: chartData.closed_issues, 
                            borderColor: '#10b981',
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', align: 'end' }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            grid: { display: true, color: '#f3f4f6' }
                        },
                        x: { grid: { display: false } }
                    }
                }
            });
        });
    </script>
</body>
</html>